/*
 * Copyright (c) 2016 Intel Corporation
 * Copyright (c) 2020 Nordic Semiconductor ASA
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 */

#include <zephyr/kernel.h>
#include <zephyr/sys/printk.h>
#include <zephyr/device.h>
#include <zephyr/drivers/pwm.h>

/**
 *-------------------------------------------------------------------------------*
 * Description                                                                   *
 *                                                                               *
 * The main function, panTompkings(), calls input() to get the next sample and   *
 * store it in a buffer. Then it runs through a chain of filters: DC block, low  *
 * pass @ 15 Hz and high pass @ 5Hz. The filtered signal goes both through a de- *
 * rivative filter, which output is then squared, and through a windowed-integra-*
 * tor.                                                                          *
 *                                                                               *
 * For a signal peak to be recognized as a fiducial point, its correspondent va- *
 * lue on both the filtered signal and the integrator must be above a certain    *
 * threshold. Additionally, there are time-restraints to prevent a T-wave from   *
 * being mistakenly identified as an R-peak: a hard 200ms restrain (a new peak   *
 * 200ms from the previous one is, necessarily, a T-wave) and a soft 360ms res-  *
 * train (the peak's squared slope must also be very high to be considered as a  *
 * real peak).                                                                   *
 *                                                                               *
 * When a peak candidate is discarded, its value is used to update the noise     *
 * thresholds - which are also used to estimate the peak thresholds.             *
 *                                                                               *
 * Two buffers keep 8 RR-intervals to calculate RR-averages: one of them keeps   *
 * the last 8 RR-intervals, while the other keeps only the RR-intervals that res-*
 * pect certain restrictions. If both averages are equal, the heart pace is con- *
 * sidered normal. If the heart rate isn't normal, the thresholds change to make *
 * it easier to detect possible weaker peaks. If no peak is detected for a long  *
 * period of time, the thresholds also change and the last discarded peak candi- *
 * date is reconsidered.                                                         *
 *-------------------------------------------------------------------------------*
 * Instructions                                                                  *
 *                                                                               *
 * Here's what you should change to adjust the code to your needs:               *
 *                                                                               *
 * On panTompkins.h:                                                             *
 * - typedef int dataType;                                                       *
 * Change it from 'int' to whatever format your data is (float, unsigned int etc)*
 *                                                                               *
 * On both panTompkins.h and panTompkins.c:                                      *
 * - void init(char file_in[], char file_out[]);                                 *
 * This function is meant to do any kind of initial setup, such as starting a    *
 * serial connection with an ECG sensor. Change its parameters to whatever info  *
 * you need and its content. The test version included here loads 2 plain text   *
 * files: an input file, with the signal as a list of integer numbers in ASCII   *
 * format and an output file where either 0 or 1 will be written for each sample,*
 * whether a peak was detected or not.                                           *
 *                                                                               *
 * On panTompkins.c:                                                             *
 * - #define WINDOWSIZE                                                          *
 * Defines the size of the integration window. The original authors suggest on   *
 * their 1985 paper a 150ms window.                                              *
 *                                                                               *
 * - #define FS                                                                  *
 * Defines the sampling frequency.                                               *
 *                                                                               *
 * - #define NOSAMPLE                                                            *
 * A value to indicate you don't have any more samples to read. Choose a value   *
 * which a sample couldn't possibly have (e.g.: a negative value if your A/D con-*
 * verter only works with positive integers).                                    *
 *                                                                               *
 * - #define BUFFSIZE                                                            *
 * The size of the signal buffers. It should fit at least 1.66 times an RR-inter-*
 * val. Heart beats should be between 60 and 80 BPS for humans. So, considering  *
 * 1.66 times 1 second should be safe.                                           *
 *                                                                               *
 * - #define DELAY 22                                                            *
 * The delay introduced to the output signal. The first DELAY samples will be ig-*
 * nored, as the filters add a delay to the output signal, causing a mismatch    *
 * between the input and output signals. It's easier to compare them this way.   *
 * If you need them both to have the same amount of samples, set this to 0. If   *
 * you're working with different filters and/or sampling rates, you might need to*
 * adjust this value.                                                            *
 *                                                                               *
 * - #include <stdio.h>                                                          *
 * The file, as it is, both gets its inputs and sends its outputs to files. It   *
 * works on both Windows and Linux. If your source isn't a file, and/or your sys-*
 * tem doesn't have the <stdio.h> header, remove it.                             *
 * Include any other headers you might need to make your implementation work,    *
 * such as hardware libraries provided by your microcontroller manufacturer.     *
 *                                                                               *
 * - The input() function                                                        *
 * Change it to get the next sample from your source (a file, a serial device etc*
 * previously set up in your init() function. Return the sample value or NOSAMPLE*
 * if there are no more available samples.                                       *
 *                                                                               *
 * - The output() function                                                       *
 * Change it to output whatever you see fit, however you see fit: an RR-interval *
 * (which can be sent as a parameter to your function using the RR arrays), the  *
 * index of sample or timestamp which caused a R peak, whether a sample was a R  *
 * peak or not etc, and it can be written on a file, displayed on screen, blink a*
 * LED etc.                                                                      *
 *                                                                               *
 * - The panTompkins() function                                                  *
 * This function is almost entirely ANSI C, which means it should work as is on  *
 * most platforms. The only lines you really have to change are the fclose() ones*
 * at the very end, which are only here to allow testing of the code on systems  *
 * such as Windows and Linux for PC. You may wish to create extra variables or   *
 * increase the buffers' size as you see fit to extract different kinds of infor-*
 * mation to output, or fine tune the detection as you see fit - such as adding  *
 * different conditions for verification, initializing self-updating variables   *
 * with empirically-obtained values or changing the filters.                     *
 *-------------------------------------------------------------------------------*
 */

#define WINDOWSIZE 20   // Integrator window size, in samples. The article recommends 150ms. So, FS*0.15.
						// However, you should check empirically if the waveform looks ok.
#define NOSAMPLE -32000 // An indicator that there are no more samples to read. Use an impossible value for a sample.
#define FS 360          // Sampling frequency.
#define BUFFSIZE 600    // The size of the buffers (in samples). Must fit more than 1.66 times an RR interval, which
                        // typically could be around 1 second.

#define DELAY 22		// Delay introduced by the filters. Filter only output samples after this one.
						// Set to 0 if you want to keep the delay. Fixing the delay results in DELAY less samples
						// in the final end result.


#include "panTompkins.h"
#include <stdio.h>      // Remove if not using the standard file functions.

const short int input_array[] = {942, 940, 941, 942, 941, 938, 937, 937, 937, 937, 938, 937, 934, 932, 934, 937, 936, 935, 933, 933, 934, 934, 935, 935, 930, 931, 933, 935, 934, 935, 932, 930, 926, 920, 916, 911, 902, 896, 896, 911, 935, 961, 992, 1036, 1092, 1144, 1181, 1194, 1172, 1115, 1040, 972, 927, 910, 908, 913, 923, 925, 929, 927, 927, 926, 927, 930, 929, 926, 925, 924, 923, 926, 925, 924, 925, 925, 925, 929, 929, 926, 925, 926, 928, 928, 928, 926, 924, 924, 928, 929, 927, 928, 923, 927, 928, 931, 928, 926, 925, 926, 927, 927, 929, 926, 925, 924, 926, 928, 927, 925, 924, 927, 927, 929, 928, 927, 925, 924, 926, 927, 927, 925, 924, 925, 927, 929, 930, 927, 926, 928, 924, 927, 929, 926, 923, 925, 924, 925, 924, 920, 918, 919, 921, 923, 921, 921, 918, 919, 922, 923, 923, 923, 918, 920, 921, 926, 926, 925, 923, 926, 932, 935, 938, 938, 938, 943, 942, 946, 944, 945, 944, 946, 947, 949, 949, 948, 949, 949, 951, 951, 951, 951, 946, 949, 950, 951, 951, 950, 946, 948, 951, 951, 950, 946, 946, 946, 948, 950, 948, 947, 944, 945, 946, 947, 946, 945, 943, 942, 945, 946, 944, 943, 945, 943, 946, 948, 948, 947, 945, 945, 945, 945, 946, 944, 943, 944, 944, 945, 945, 944, 940, 943, 941, 946, 943, 943, 941, 941, 943, 945, 945, 943, 940, 942, 944, 947, 947, 945, 941, 942, 944, 947, 946, 946, 942, 942, 945, 943, 945, 942, 941, 942, 943, 944, 945, 944, 941, 942, 945, 946, 945, 947, 948, 951, 955, 960, 961, 961, 956, 956, 961, 962, 962, 960, 961, 961, 965, 966, 966, 967, 963, 963, 964, 964, 962, 959, 957, 959, 960, 962, 961, 961, 962, 968, 970, 967, 961, 956, 951, 951, 949, 947, 946, 939, 937, 939, 941, 942, 943, 941, 938, 938, 940, 941, 942, 941, 936, 938, 941, 942, 940, 939, 937, 938, 937, 939, 936, 931, 921, 914, 913, 910, 903, 896, 894, 905, 930, 959, 988, 1023, 1070, 1127, 1175, 1201, 1210, 1191, 1137, 1056, 984, 941, 917, 912, 912, 920, 927, 935, 937, 936, 935, 933, 933, 934, 933, 930, 927, 927, 928, 929, 928, 928, 926, 926, 926, 928, 930, 928, 925, 926, 928, 932, 932, 933, 928, 928, 932, 933, 933, 932, 926, 929, 929, 931, 934, 931, 929, 930, 931, 933, 934, 933, 930, 929, 933, 935, 935, 934, 930, 931, 933, 934, 935, 932, 929, 929, 931, 934, 934, 929, 930, 930, 930, 932, 934, 930, 930, 929, 931, 934, 935, 931, 930, 930, 933, 931, 934, 932, 931, 929, 932, 933, 932, 930, 928, 928, 929, 931, 931, 929, 929, 927, 930, 933, 932, 931, 930, 929, 934, 936, 938, 938, 937, 940, 945, 947, 949, 950, 950, 951, 953, 956, 954, 952, 949, 952, 954, 955, 955, 952, 951, 951, 953, 953, 953, 952, 949, 951, 951, 953, 954, 952, 952, 953, 953, 957, 955, 954, 950, 950, 950, 952, 951, 948, 947, 947, 951, 951, 952, 951, 948, 948, 950, 953, 953, 951, 950, 949, 951, 954, 953, 948, 947, 948, 951, 950, 948, 949, 944, 946, 946, 949, 949, 946, 944, 943, 945, 945, 945, 944, 944, 943, 946, 949, 949, 946, 945, 947, 947, 947, 948, 948, 944, 946, 946, 949, 948, 946, 944, 946, 946, 947, 947, 946, 945, 946, 946, 949, 948, 949, 947, 947, 948, 949, 950, 948, 949, 948, 951, 955, 956, 954, 955, 959, 961, 961, 963, 961, 961, 963, 966, 968, 970, 970, 967, 968, 968, 969, 969, 966, 964, 966, 967, 969, 969, 966, 967, 971, 974, 972, 966, 961, 956, 950, 949, 950, 950, 946, 944, 944, 946, 947, 946, 943, 941, 943, 943, 944, 947, 945, 941, 942, 944, 945, 943, 940, 940, 939, 941, 942, 941, 936, 927, 920, 916, 914, 908, 898, 888, 885, 890, 895, 905, 919, 931, 946, 958, 979, 1014, 1061, 1112, 1158, 1186, 1189, 1156, 1095, 1017, 954, 924, 918, 923, 930, 933, 934, 934, 937, 938, 936, 934, 933, 933, 936, 937, 936, 934, 934, 936, 939, 939, 939, 933, 933, 938, 939, 936, 936, 934, 935, 937, 939, 940, 938, 937, 938, 937, 938, 938, 935, 934, 934, 937, 938, 939, 939, 937, 937, 941, 940, 938, 937, 935, 935, 936, 936, 936, 936, 936, 934, 937, 938, 939, 940, 936, 935, 940, 940, 940, 939, 937, 939, 942, 942, 940, 938, 936, 937, 935, 941, 938, 940, 937, 937, 938, 939, 939, 938, 935, 936, 936, 939, 936, 935, 932, 932, 935, 935, 937, 935, 933, 932, 937, 938, 937, 936, 935, 936, 941, 942, 946, 945, 945, 945, 948, 952, 951, 949, 946, 947, 953, 955, 955, 956, 952, 952, 952, 957, 956, 955, 952, 952, 953, 954, 954, 951, 950, 948, 949, 953, 952, 951, 950, 951, 953, 955, 954, 953, 949, 948, 951, 954, 953, 951, 949, 950, 951, 950, 950, 949, 947, 946, 948, 948, 949, 948, 946, 945, 946, 948, 949, 947, 943, 946, 945, 949, 946, 946, 942, 943, 944, 947, 946, 943, 943, 944, 945, 948, 948, 947, 946, 946, 947, 948, 945, 944, 943, 941, 945, 946, 946, 949, 946, 946, 948, 948, 947, 946, 942, 944, 946, 948, 947, 946, 948, 952, 954, 959, 958, 958, 958, 955, 962, 965, 967, 968, 968, 969, 971, 969, 970, 969, 964, 965, 967, 965, 964, 959, 959, 963, 967, 967, 962, 956, 950, 948, 946, 948, 948, 947, 942, 943, 945, 946, 946, 942, 938, 941, 940, 943, 943, 943, 943, 942, 943, 942, 941, 939, 939, 941, 941, 943, 943, 942, 939, 937, 935, 927, 920, 915, 908, 901, 903, 919, 948, 978, 1014, 1065, 1124, 1170, 1191, 1175, 1120, 1039, 969, 930, 915, 915, 923, 930, 933, 936, 936, 935, 935, 934, 935, 934, 936, 934, 932, 931, 935, 935, 934, 933, 931, 930, 932, 934, 933, 933, 931, 932, 936, 937, 936, 934, 933, 934, 935, 935, 935, 933, 933, 935, 936, 936, 933, 929, 931, 931, 933, 936, 936, 935, 935, 936, 936, 937, 936, 933, 931, 930, 929, 934, 935, 936, 934, 932, 934, 937, 937, 933, 932, 931, 932, 934, 933, 933, 931, 933, 933, 935, 931, 930, 928, 927, 926, 927, 928, 925, 921, 921, 923, 927, 928, 925, 923, 925, 925, 929, 932, 931, 931, 935, 938, 942, 941, 942, 942, 943, 948, 951, 951, 950, 950, 952, 953, 955, 955, 958, 955, 955, 957, 956, 957, 958, 955, 956, 957, 960, 958, 957, 954, 955, 958, 960, 958, 956, 955, 954, 957, 959, 956, 955, 952, 950, 956, 958, 956, 956, 953, 954, 952, 956, 957, 954, 952, 950, 952, 953, 954, 951, 949, 952, 950, 952, 952, 950, 948, 948, 950, 954, 954, 953, 952, 954, 954, 956, 955, 953, 951, 951, 952, 954, 952, 951, 949, 948, 949, 952, 953, 950, 948, 951, 954, 953, 953, 953, 950, 952, 954, 957, 955, 954, 953, 955, 959, 962, 962, 963, 963, 963, 967, 969, 971, 971, 972, 975, 976, 979, 976, 977, 975, 972, 976, 978, 975, 973, 974, 973, 972, 972, 976, 976, 975, 974, 970, 967, 963, 958, 955, 955, 953, 953, 952, 951, 951, 950, 954, 954, 953, 951, 949, 949, 952, 953, 953, 952, 948, 947, 949, 950, 947, 942, 935, 926, 923, 919, 908, 905, 915, 942, 972, 1007, 1048, 1102, 1151, 1193, 1210, 1196, 1139, 1056, 981, 933, 918, 916, 917, 914, 917, 922, 932, 942, 942, 939, 938, 938, 939, 942, 942, 939, 938, 939, 940, 943, 942, 942, 942, 940, 943, 945, 945, 942, 941, 940, 942, 944, 942, 940, 940, 939, 941, 941, 943, 941, 940, 938, 939, 943, 942, 942, 940, 941, 944, 947, 945, 945, 943, 943, 944, 946, 945, 943, 940, 940, 943, 946, 944, 942, 940, 939, 942, 944, 945, 943, 942, 940, 944, 943, 943, 942, 939, 941, 941, 944, 943, 941, 938, 940, 942, 940, 939, 940, 936, 938, 937, 938, 938, 937, 936, 938, 940, 942, 942, 945, 947, 948, 952, 956, 958, 957, 957, 958, 960, 960, 960, 960, 962, 961, 964, 965, 965, 963, 963, 963, 965, 967, 964, 965, 965, 964, 966, 968, 965, 963, 962, 960, 964, 964, 962, 963, 960, 959, 959, 961, 963, 961, 960, 958, 959, 963, 959, 960, 959, 957, 961, 960, 960, 958, 956, 955, 955, 959, 959, 955, 954, 954, 955, 959, 958, 956, 956, 957, 957, 960, 959, 960, 956, 957, 958, 956, 957, 956, 955, 953, 956, 958, 956, 956, 955, 954, 957, 955, 957, 956, 957, 955, 958, 960, 959, 960, 957, 954, 956, 959, 960, 957, 955, 958, 958, 963, 963, 967, 967, 969, 968, 971, 972, 973, 974, 975, 979, 982, 986, 980, 980, 978, 978, 980, 977, 975, 972, 974, 976, 978, 978, 975, 970, 967, 973, 978, 981, 982, 979, 972, 967, 968, 963, 961, 957, 955, 957, 957, 956, 956, 953, 953, 953, 955, 951, 947, 948, 947, 949, 951, 950, 949, 948, 948, 949, 950, 949, 946, 939, 933, 927, 927, 920, 913, 907, 918, 947, 977, 1005, 1047, 1097, 1151, 1192, 1209, 1196, 1143, 1063, 980, 935, 923, 928, 937, 941, 943, 946, 946, 945, 944, 942, 941, 944, 945, 943, 943, 943, 943, 945, 948, 946, 943, 943, 942, 943, 945, 945, 943, 942, 943, 943, 946, 944, 943, 940, 939, 943, 944, 945, 945, 944, 944, 944, 947, 946, 945, 945, 944, 947, 947, 945, 945, 944, 944, 945, 946, 945, 944, 942, 942, 943, 946, 947, 945, 943, 942, 944, 948, 947, 946, 945, 945, 947, 947, 946, 944, 945, 944, 946, 947, 945, 943, 943, 940, 942, 945, 943, 942, 939, 940, 939, 944, 943, 943, 945, 943, 945, 947, 945, 944, 945, 945, 948, 951, 949, 950, 950, 949, 953, 958, 957, 955, 954, 957, 960, 963, 962, 961, 960, 960, 962, 963, 962, 965, 963, 964, 966, 967, 966, 965, 964, 963, 962, 962, 963, 964, 961, 958, 960, 963, 962, 960, 961, 956, 960, 961, 959, 958, 958, 957, 961, 961, 962, 960, 960, 960, 958, 960, 960, 958, 956, 958, 957, 957, 958, 956, 955, 954, 955, 958, 957, 955, 954, 954, 954, 957, 956, 956, 952, 953, 952, 955, 956, 954, 953, 954, 955, 957, 958, 955, 954, 953, 954, 957, 957, 957, 955, 953, 953, 954, 957, 956, 954, 952, 955, 959, 957, 955, 954, 956, 959, 963, 966, 971, 973, 969, 972, 974, 971, 971, 973, 974, 974, 979, 979, 976, 974, 974, 974, 975, 975, 974, 975, 973, 974, 975, 971, 971, 969, 969, 975, 982, 983, 977, 969, 964, 966, 964, 958, 955, 954, 951, 953, 956, 954, 952, 949, 950, 950, 952, 951, 949, 948, 947, 952, 952, 952, 952, 948, 946, 945, 949, 943, 934, 926, 920, 915, 910, 904, 911, 928, 957, 990, 1032, 1087, 1138, 1170, 1178, 1155, 1100, 1024, 962, 927, 920, 929, 940, 942, 939, 939, 938, 938, 942, 940, 936, 937, 935, 936, 939, 941, 939, 936, 933, 934, 938, 939, 938, 935, 936, 938, 941, 941, 938, 936, 935, 937, 941, 940, 936, 937, 935, 939, 940, 938, 938, 936, 937, 937, 939, 938, 936, 936, 935, 936, 939, 938, 938, 937, 937, 937, 938, 937, 937, 938, 939, 940, 943, 940, 938, 937, 935, 939, 942, 940, 937, 936, 935, 937, 938, 938, 936, 932, 929, 934, 936, 936, 936, 929, 932, 934, 936, 936, 934, 932, 930, 931, 934, 934, 931, 933, 932, 934, 937, 937, 938, 937, 938, 943, 943, 947, 947, 947, 946, 948, 950, 949, 950, 952, 951, 952, 955, 952, 954, 954, 953, 954, 954, 956, 953, 949, 948, 951, 954, 952, 950, 950, 948, 947, 950, 949, 946, 944, 945, 947, 952, 951, 949, 949, 947, 948, 947, 947, 946, 945, 944, 946, 948, 949, 947, 945, 941, 943, 946, 946, 943, 942, 941, 943, 944, 942, 946, 944, 943, 945, 945, 944, 943, 942, 942, 945, 945, 945, 944, 941, 941, 943, 946, 946, 944, 945, 943, 945, 945, 944, 941, 940, 938, 940, 941, 942, 942, 941, 943, 946, 949, 947, 946, 946, 946, 947, 948, 951, 950, 950, 950, 955, 957, 956, 956, 956, 957, 960, 963, 963, 964, 962, 959, 961, 962, 960, 959, 961, 960, 959, 960, 959, 958, 960, 963, 963, 960, 952, 945, 946, 941, 942, 943, 940, 937, 935, 933, 937, 939, 940, 937, 938, 933, 935, 938, 938, 937, 933, 934, 936, 938, 941, 935, 931, 934, 935, 934, 925, 917, 913, 909, 903, 896, 898, 909, 932, 959, 994, 1041, 1094, 1141, 1171, 1178, 1150, 1092, 1015, 952, 920, 910, 913, 922, 925, 926, 924, 926, 929, 928, 930, 928, 927, 928, 927, 930, 929, 930, 928, 927, 932, 933, 930, 930, 929, 927, 931, 933, 934, 932, 932, 931, 930, 932, 930, 927, 923, 924, 927, 928, 927, 928, 928, 927, 929, 931, 931, 930, 930, 929, 930, 930, 929, 929, 926, 928, 927, 929, 929, 926, 925, 925, 927, 928, 930, 926, 926, 926, 927, 930, 929, 927, 927, 924, 928, 929, 929, 928, 924, 923, 925, 927, 926, 920, 919, 918, 919, 921, 920, 916, 917, 916, 917, 919, 918, 918, 920, 922, 924, 929, 928, 929, 929, 931, 934, 936, 938, 940, 940, 939, 944, 947, 947, 947, 946, 949, 949, 950, 952, 950, 949, 950, 953, 955, 954, 954, 951, 951, 952, 953, 952, 950, 949, 949, 949, 952, 950, 948, 944, 944, 946, 948, 948, 949, 947, 947, 949, 951, 952, 950, 946, 947, 948, 949, 950, 946, 944, 943, 945, 948, 947, 946, 945, 943, 946, 946, 943, 944, 944, 943, 944, 945, 945, 943, 941, 942, 942, 944, 944, 944, 941, 942, 944, 947, 945, 944, 941, 943, 944, 947, 947, 946, 945, 944, 946, 947, 947, 945, 944, 944, 945, 944, 944, 942, 943, 943, 946, 946, 947, 947, 944, 948, 948, 955, 956, 958, 959, 960, 961, 962, 962, 962, 961, 963, 969, 968, 969, 970, 967, 965, 965, 967, 966, 962, 960, 962, 964, 967, 964, 961, 962, 966, 969, 972, 968, 960, 958, 954, 954, 953, 949, 947, 944, 938, 941, 945, 947, 943, 941, 942, 942, 944, 944, 942, 943, 941, 944, 945, 944, 943, 942, 943, 945, 945, 944, 943, 942, 940, 940, 941, 928, 920, 916, 915, 914, 905, 901, 906, 926, 955, 986, 1026, 1074, 1127, 1169, 1194, 1199, 1162, 1088, 1002, 943, 918, 921, 933, 938, 940, 940, 936, 938, 938, 939, 938, 935, 934, 936, 940, 939, 937, 938, 935, 938, 941, 939, 940, 936, 935, 938, 940, 940, 939, 938, 935, 940, 943, 940, 938, 936, 935, 938, 941, 938, 936, 936, 936, 938, 938, 940, 938, 936, 934, 936, 940, 939, 940, 938, 936, 939, 940, 944, 942, 940, 938, 940, 943, 942, 938, 936, 937, 940, 941, 938, 938, 937, 937, 937, 939, 937, 937, 936, 936, 937, 939, 939, 935, 936, 933, 935, 936, 936, 934, 937, 935, 937, 938, 938, 938, 936, 936, 938, 940, 941, 941, 942, 943, 947, 950, 951, 951, 951, 954, 955, 959, 959, 959, 956, 957, 961, 964, 964, 961, 964, 963, 963, 965, 962, 962, 961, 959, 961, 964, 962, 963, 960, 960, 962, 962, 962, 962, 960, 959, 960, 964, 966, 962, 960, 959, 964, 964, 964, 963, 959, 957, 959, 962, 959, 958, 958, 956, 958, 961, 960, 958, 956, 956, 957, 959, 960, 957, 957, 956, 956, 959, 957, 956, 954, 952, 953, 957, 957, 953, 953, 952, 954, 954, 955, 954, 952, 954, 956, 957, 956, 956, 955, 954, 955, 959, 959, 961, 956, 956, 959, 958, 958, 957, 957, 955, 956, 958, 958, 955, 954, 956, 961, 963, 967, 967, 968, 967, 970, 975, 973, 968, 967, 966, 970, 973, 975, 976, 972, 974, 977, 978, 979, 975, 975, 973, 974, 973, 976, 974, 973, 969, 973, 976, 979, 980, 978, 972, 967, 966, 965, 960, 955, 954, 955, 956, 955, 951, 950, 949, 951, 951, 951, 952, 950, 949, 949, 949, 951, 949, 949, 947, 950, 952, 953, 950, 949, 944, 940, 935, 928, 923, 916, 909, 905, 907, 920, 943, 967, 995, 1034, 1087, 1141, 1178, 1194, 1187, 1144, 1080, 1004, 950, 925, 924, 933, 943, 946, 944, 942, 942, 946, 949, 947, 945, 941, 942, 944, 945, 947, 946, 943, 942, 946, 945, 946, 944, 939, 942, 945, 946, 944, 944, 943, 942, 945, 945, 946, 943, 944, 945, 945, 947, 946, 945, 943, 944, 947, 949, 947, 946, 943, 944, 946, 944, 943, 942, 944, 941, 943, 946, 947, 944, 942, 942, 946, 948, 950, 947, 945, 946, 949, 947, 946, 946, 945, 942, 945, 948, 944, 944, 944, 942, 942, 944, 942, 944, 941, 939, 941, 944, 943, 943, 941, 940, 943, 945, 946, 944, 941, 944, 946, 948, 949, 947, 948, 947, 951, 952, 955, 955, 955, 956, 958, 962, 962, 961, 959, 960, 963, 965, 965, 965, 964, 962, 965, 967, 967, 965, 962, 963, 963, 965, 966, 966, 963, 963, 965, 966, 963, 962, 960, 959, 960, 964, 961, 961, 959, 959, 960, 962, 961, 958, 956, 957, 959, 961, 960, 959, 958, 956, 959, 962, 961, 959, 958, 957, 955, 957, 957, 956, 955, 955, 955, 957, 957, 956, 953, 955, 954, 957, 958, 957, 956, 954, 957, 958, 957, 956, 955, 953, 955, 958, 957, 956, 954, 952, 953, 955, 956, 954, 955, 953, 955, 958, 959, 957, 957, 955, 958, 959, 959, 958, 958, 962, 966, 970, 971, 968, 964, 965, 970, 976, 977, 977, 977, 977, 978, 981, 980, 978, 978, 973, 975, 977, 976, 975, 970, 969, 970, 972, 975, 978, 979, 979, 984, 984, 978, 971, 965, 963, 962, 962, 960, 956, 955, 952, 953, 956, 956, 954, 952, 952, 951, 952, 949, 948, 947, 948, 949, 950, 949, 950, 949, 947, 951, 950, 947, 944, 936, 932, 929, 929, 920, 908, 903, 915, 935, 961, 988, 1024, 1071, 1123, 1163, 1182, 1176, 1136, 1073, 1002, 952, 929, 922, 926, 931, 936, 937, 941, 939, 941, 939, 937, 945, 947, 947, 944, 942, 940, 942, 943, 942, 944, 940, 937, 940, 943, 943, 941, 941, 940, 940, 944, 942, 941, 939, 938, 941, 941, 942, 941, 940, 940, 941, 945, 944, 943, 941, 941, 940, 941, 939, 939, 937, 937, 939, 941, 941, 940, 939, 938, 940, 942, 942, 942, 941, 939, 943, 944, 944, 942, 941, 941, 943, 945, 947, 945, 945, 941, 945, 946, 945, 943, 941, 939, 941, 941, 941, 939, 937, 935, 935, 935, 935, 936, 934, 937, 938, 939, 937, 935, 935, 938, 939, 940, 939, 941, 941, 942, 943, 949, 950, 951, 951, 952, 955, 956, 958, 957, 957, 958, 958, 961, 961, 961, 961, 959, 960, 960, 964, 960, 958, 957, 960, 963, 961, 959, 957, 956, 956, 960, 957, 957, 955, 954, 958, 958, 958, 957, 957, 955, 955, 959, 955, 958, 956, 955, 956, 954, 956, 956, 954, 950, 953, 956, 955, 954, 951, 950, 950, 953, 952, 953, 952, 949, 950, 953, 955, 953, 951, 952, 952, 952, 951, 949, 948, 950, 952, 956, 958, 956, 956, 951, 953, 954, 952, 950, 949, 950, 951, 952, 953, 952, 953, 950, 953, 956, 955, 953, 952, 951, 953, 958, 958, 960, 963, 964, 969, 970, 967, 965, 967, 970, 972, 974, 975, 975, 973, 971, 974, 975, 971, 971, 969, 966, 967, 967, 967, 966, 968, 969, 967, 967, 964, 958, 954, 949, 952, 954, 953, 952, 949, 951, 952, 951, 948, 948, 946, 944, 946, 948, 948, 948, 944, 944, 946, 948, 948, 948, 946, 946, 947, 949, 945, 938, 930, 926, 923, 917, 908, 906, 921, 947, 979, 1012, 1055, 1107, 1151, 1179, 1188, 1166, 1099, 1022, 964, 932, 922, 925, 933, 939, 942, 938, 942, 945, 946, 944, 942, 939, 941, 942, 942, 941, 940, 939, 941, 942, 942, 942, 941, 938, 938, 939, 940, 939, 938, 937, 939, 939, 939, 937, 936, 937, 939, 940, 940, 941, 939, 938, 940, 941, 938, 940, 937, 937, 939, 939, 938, 938, 934, 936, 938, 943, 940, 937, 938, 937, 937, 940, 939, 937, 939, 940, 941, 942, 942, 938, 938, 936, 937, 939, 938, 933, 933, 930, 931, 931, 931, 930, 926, 927, 930, 931, 931, 931, 929, 929, 932, 931, 931, 929, 931, 929, 931, 934, 936, 937, 938, 941, 945, 946, 947, 951, 951, 952, 957, 959, 958, 955, 958, 959, 960, 962, 961, 960, 960, 957, 960, 961, 962, 960, 961, 960, 959, 960, 960, 959, 958, 957, 958, 963, 961, 958, 957, 956, 954, 958, 959, 959, 954, 954, 955, 958, 960, 955, 956, 954, 956, 959, 958, 956, 954, 952, 953, 955, 954, 953, 952, 950, 952, 956, 955, 953, 953, 953, 954, 956, 955, 953, 953, 953, 951, 953, 953, 952, 949, 951, 953, 954, 954, 953, 951, 950, 952, 953, 953, 953, 952, 952, 952, 957, 957, 953, 952, 951, 955, 957, 955, 952, 952, 952, 955, 963, 965, 967, 967, 967, 969, 971, 972, 976, 975, 973, 978, 978, 975, 973, 972, 973, 972, 973, 973, 971, 970, 968, 967, 969, 975, 977, 977, 970, 966, 966, 962, 958, 954, 953, 953, 953, 952, 950, 947, 947, 950, 950, 950, 949, 947, 945, 950, 952, 951, 950, 949, 949, 950, 951, 950, 943, 933, 924, 922, 920, 910, 905, 913, 935, 969, 1003, 1044, 1096, 1150, 1190, 1221, 1228, 1205, 1155, 1098, 1045, 1008, 980, 956, 937, 922, 910, 908, 920, 932, 941, 941, 939, 941, 943, 941, 940, 937, 937, 938, 940, 939, 939, 937, 937, 941, 943, 942, 941, 942, 942, 941, 944, 943, 940, 938, 937, 940, 943, 939, 938, 938, 939, 941, 942, 943, 940, 939, 938, 941, 943, 943, 942, 940, 939, 942, 944, 941, 944, 942, 942, 944, 946, 946, 943, 942, 939, 941, 943, 944, 942, 939, 940, 941, 943, 942, 944, 940, 941, 939, 943, 940, 939, 938, 936, 941, 940, 939, 940, 936, 939, 939, 939, 939, 938, 937, 935, 939, 941, 941, 941, 942, 944, 945, 950, 952, 952, 955, 955, 955, 958, 961, 959, 958, 957, 960, 963, 963, 962, 959, 958, 961, 960, 962, 960, 961, 959, 960, 962, 962, 961, 961, 959, 962, 963, 962, 960, 959, 959, 960, 961, 959, 959, 956, 956, 957, 957, 958, 956, 954, 955, 956, 957, 958, 957, 955, 955, 955, 957, 956, 955, 953, 954, 954, 956, 955, 952, 951, 950, 953, 953, 952, 951, 950, 949, 953, 954, 952, 951, 951, 951, 954, 955, 954, 955, 951, 952, 952, 953, 951, 952, 952, 951, 951, 954, 955, 953, 953, 952, 954, 957, 956, 957, 957, 957, 962, 966, 970, 968, 965, 965, 967, 970, 972, 973, 973, 972, 974, 973, 975, 976, 974, 972, 972, 973, 972, 971, 970, 969, 971, 972, 974, 976, 978, 971, 967, 965, 957, 958, 954, 950, 952, 953, 952, 951, 949, 948, 952, 952, 951, 951, 949, 948, 950, 948, 949, 949, 946, 947, 949, 948, 947, 941, 930, 923, 920, 917, 909, 905, 918, 941, 974, 1011, 1057, 1112, 1158, 1192, 1211, 1222, 1206, 1162, 1100, 1024, 963, 929, 921, 923, 930, 935, 941, 941, 940, 940, 939, 937, 941, 942, 942, 941, 941, 940, 942, 942, 944, 942, 939, 937, 940, 941, 943, 942, 938, 939, 939, 944, 941, 942, 941, 939, 941, 943, 943, 942, 942, 942, 942, 946, 947, 946, 943, 942, 945, 946, 945, 943, 944, 943, 942, 945, 946, 945, 944, 943, 944, 946, 946, 943, 943, 941, 944, 946, 945, 944, 941, 942, 946, 947, 944, 944, 940, 943, 944, 944, 945, 944, 940, 937, 941, 945, 944, 940, 939, 940, 941, 944, 943, 941, 940, 940, 943, 943, 945, 945, 945, 945, 947, 949, 950, 953, 950, 952, 955, 957, 960, 957, 957, 956, 959, 960, 961, 959, 957, 957, 961, 959, 960, 958, 958, 957, 958, 960, 958, 960, 959, 959, 958, 960, 960, 959, 957, 956, 958, 960, 958, 953, 952, 952, 953, 954, 953, 954, 951, 952, 950, 953, 951, 951, 951, 947, 949, 950, 952, 951, 949, 946, 947, 948, 949, 947, 945, 946, 945, 949, 946, 947, 944, 946, 948, 951, 951, 949, 949, 947, 947, 951, 951, 949, 944, 946, 948, 950, 949, 947, 945, 946, 946, 947, 946, 947, 947, 946, 946, 951, 953, 951, 950, 949, 949, 951, 950, 953, 955, 958, 960, 964, 964, 960, 959, 962, 963, 966, 969, 969, 966, 967, 969, 968, 967, 964, 964, 965, 969, 969, 966, 964, 965, 966, 971, 968, 962, 957, 953, 948, 945, 948, 944, 942, 941, 941, 943, 947, 944, 943, 939, 942, 945, 949, 947, 945, 944, 944, 946, 946, 946, 944, 942, 942, 942, 939, 939, 940, 936, 935, 933, 928, 923, 918, 911, 900, 898, 907, 926, 950, 974, 1008, 1060, 1115, 1154, 1177, 1171, 1132, 1063, 997, 947, 919, 911, 918, 926, 931, 933, 932, 930, 931, 932, 935, 937, 936, 936, 934, 933, 935, 933, 932, 933, 932, 935, 937, 936, 934, 933, 934, 932, 935, 934, 934, 933, 930, 932, 933, 935, 932, 933, 933, 933, 932, 931, 931, 929, 931, 934, 935, 935, 933, 932, 933, 933, 936, 936, 934, 933, 932, 935, 937, 935, 933, 931, 927, 929, 933, 935, 935, 934, 933, 934, 937, 935, 934, 934, 932, 934, 936, 935, 932, 929, 929, 931, 932, 930, 928, 924, 924, 927, 927, 927, 926, 925, 923, 926, 924, 923, 923, 922, 921, 923, 924, 925, 923, 924, 924, 928, 933, 939, 939, 941, 943, 945, 948, 947, 948, 947, 945, 947, 950, 953, 953, 950, 950, 953, 955, 956, 955, 956, 955, 956, 957, 954, 954, 954, 953, 956, 957, 955, 957, 957, 957, 959, 961, 960, 956, 954, 954, 954, 957, 954, 951, 951, 950, 950, 953, 953, 952, 950, 950, 950, 953, 953, 953, 948, 950, 951, 954, 954, 951, 952, 949, 951, 952, 952, 948, 946, 947, 948, 949, 949, 947, 945, 943, 947, 951, 948, 947, 949, 949, 950, 952, 952, 950, 948, 948, 950, 953, 951, 950, 948, 948, 949, 951, 950, 947, 944, 946, 947, 951, 951, 947, 948, 947, 947, 951, 952, 953, 954, 954, 960, 962, 964, 963, 963, 963, 966, 969, 967, 969, 970, 970, 971, 973, 971, 967, 967, 964, 965, 968, 969, 966, 963, 962, 968, 975, 974, 969, 964, 959, 957, 955, 952, 952, 950, 947, 946, 947, 947, 947, 946, 944, 943, 945, 947, 945, 944, 942, 942, 946, 945, 945, 944, 944, 946, 950, 950, 948, 948, 945, 947, 948, 944, 939, 932, 925, 921, 920, 912, 905, 911, 931, 962, 991, 1030, 1083, 1134, 1175, 1196, 1187, 1139, 1065, 988, 936, 919, 920, 929, 936, 938, 936, 938, 941, 943, 940, 939, 937, 939, 941, 941, 940, 940, 939, 941, 944, 942, 944, 940, 941, 941, 944, 942, 942, 939, 937, 940, 942, 943, 940, 937, 939, 941, 940, 941, 942, 938, 938, 940, 943, 944, 942, 941, 941, 943, 944, 944, 942, 943, 941, 944, 944, 941, 940, 943, 940, 941, 942, 942, 940, 939, 941, 941, 942, 943, 942, 938, 939, 942, 943, 943, 942, 940, 939, 939, 941, 939, 938, 937, 935, 936, 934, 934, 932, 931, 931, 932, 933, 933, 934, 932, 932, 935, 938, 938, 935, 937, 939, 944, 947, 949, 949, 948, 950, 954, 958, 959, 959, 960, 961, 961, 965, 964, 965, 962, 964, 966, 968, 967, 967, 966, 964, 967, 968, 967, 968, 965, 963, 966, 969, 966, 965, 964, 961, 963, 966, 964, 963, 962, 962, 962, 964, 965, 963, 960, 961, 962, 964, 966, 964, 960, 960, 964, 965, 965, 962, 960, 961, 963, 962, 960, 959, 962, 959, 962, 962, 962, 959, 958, 958, 960, 964, 962, 964, 961, 959, 962, 965, 964, 962, 960, 958, 961, 964, 962, 959, 958, 956, 959, 960, 960, 958, 957, 958, 957, 961, 961, 960, 960, 958, 959, 959, 959, 960, 957, 958, 962, 965, 965, 962, 962, 962, 966, 967, 970, 972, 974, 972, 971, 974, 975, 974, 975, 975, 979, 985, 984, 983, 980, 979, 980, 981, 977, 980, 978, 977, 978, 978, 979, 980, 985, 988, 987, 982, 976, 973, 971, 967, 964, 964, 964, 961, 957, 956, 956, 961, 959, 958, 956, 954, 958, 960, 957, 958, 956, 955, 957, 956, 958, 956, 954, 954, 953, 954, 953, 945, 938, 929, 927, 925, 914, 910, 915, 936, 964, 997, 1032, 1081, 1137, 1185, 1213, 1214, 1172, 1092, 1009, 950, 928, 931, 943, 950, 951, 948, 949, 952, 953, 950, 949, 949, 951, 952, 952, 949, 946, 946, 947, 949, 948, 950, 947, 948, 948, 950, 950, 947, 945, 944, 947, 951, 949, 947, 947, 946, 947, 949, 948, 948, 946, 947, 948, 949, 946, 946, 948, 948, 951, 954, 951, 951, 951, 949, 951, 950, 949, 949, 948, 947, 948, 951, 952, 952, 950, 949, 951, 953, 953, 951, 951, 951, 950, 953, 951, 952, 951, 950, 952, 955, 956, 952, 951, 949, 951, 952, 951, 950, 946, 946, 947, 951, 951, 950, 948, 948, 949, 952, 953, 953, 950, 949, 953, 957, 958, 960, 959, 960, 963, 965, 966, 966, 964, 965, 968, 969, 970, 971, 969, 968, 970, 972, 970, 971, 968, 966, 968, 971, 971, 971, 970, 967, 971, 973, 973, 970, 970, 968, 971, 972, 971, 969, 967, 966, 968, 968, 967, 966, 965, 964, 965, 967, 967, 965, 964, 963, 963, 964, 966, 966, 961, 962, 966, 968, 968, 966, 963, 965, 965, 966, 963, 963, 960, 962, 961, 964, 962, 962, 959, 960, 960, 963, 961, 962, 959, 957, 963, 962, 964, 962, 962, 962, 962, 965, 967, 965, 963, 962, 962, 964, 967, 965, 963, 963, 964, 965, 965, 963, 962, 960, 961, 964, 965, 964, 965, 964, 968, 972, 974, 976, 975, 976, 978, 980, 982, 985, 983, 985, 987, 988, 989, 987, 983, 981, 983, 983, 984, 983, 979, 978, 979, 985, 990, 989, 981, 975, 974, 976, 972, 968, 963, 961, 961, 962, 963, 962, 960, 957, 960, 963, 962, 962, 958, 956, 958, 962, 959, 957, 956, 955, 957, 959, 959, 956, 956, 955, 951, 947, 940, 935, 930, 922, 917, 925, 945, 969, 994, 1030, 1080, 1132, 1174, 1202, 1218, 1228, 1223, 1198, 1157, 1101, 1042, 988, 950, 931, 929, 933, 936, 945, 950, 952, 954, 953, 953, 952, 953, 953, 954, 954, 951, 951, 952, 953, 953, 950, 949, 948, 950, 950, 952, 951, 947, 946, 951, 952, 952, 953, 951, 949, 951, 952, 952, 952, 950, 950, 952, 954, 953, 952, 951, 948, 952, 954, 952, 954, 948, 947, 950, 953, 953, 953, 949, 950, 955, 955, 954, 953, 951, 953, 956, 958, 956, 953, 951, 952, 957, 956, 954, 951, 950, 950, 950, 951, 952, 953, 949, 948, 950, 952, 951, 948, 947, 947, 946, 948, 947, 946, 943, 945, 948, 952, 954, 952, 952, 952, 956, 959, 960, 962, 960, 957, 961, 963, 961, 963, 961, 962, 968, 966, 967, 965, 964, 967, 967, 966, 966, 965, 964, 961, 964, 966, 968, 965, 963, 964, 964, 966, 964, 962, 961, 960, 962, 960, 961, 959, 958, 957, 958, 959, 962, 960, 958, 956, 955, 957, 958, 957, 955, 957, 958, 959, 959, 957, 957, 957, 956, 958, 957, 955, 954, 952, 953, 955, 957, 956, 953, 953, 955, 957, 956, 954, 953, 953, 953, 955, 955, 954, 953, 953, 955, 954, 957, 957, 953, 953, 954, 954, 956, 953, 949, 951, 953, 955, 952, 954, 953, 955, 957, 961, 965, 965, 963, 963, 966, 968, 971, 971, 971, 971, 976, 978, 977, 974, 974, 973, 973, 972, 971, 970, 970, 971, 972, 969, 970, 972, 974, 972, 969, 966, 965, 960, 956, 950, 952, 950, 947, 946, 944, 947, 947, 948, 950, 948, 947, 948, 949, 949, 948, 945, 944, 945, 948, 950, 950, 949, 945, 944, 947, 947, 947, 944, 938, 935, 931, 929, 922, 909, 903, 911, 934, 963, 996, 1036, 1084, 1134, 1172, 1186, 1167, 1108, 1031, 964, 931, 920, 926, 934, 939, 935, 937, 937, 936, 938, 939, 938, 942, 941, 941, 940, 935, 933, 937, 939, 940, 938, 937, 937, 937, 939, 938, 938, 935, 934, 935, 938, 937, 938, 937, 938, 939, 940, 941, 941, 936, 935, 937, 939, 938, 936, 931, 932, 934, 935, 934, 933, 935, 934, 936, 938, 941, 939, 939, 935, 938, 938, 935, 935, 933, 935, 934, 936, 937, 936, 934, 932, 934, 936, 936, 934, 933, 930, 930, 929, 927, 929, 929, 927, 928, 929, 927, 926, 923, 922, 921, 923, 928, 925, 927, 927, 932, 936, 937, 940, 941, 940, 944, 948, 952, 952, 950, 950, 953, 956, 958, 959, 957, 954, 955, 957, 957, 957, 953, 954, 954, 956, 957, 956, 954, 953, 955, 958, 957, 956, 954, 954, 955, 956, 954, 953, 952, 949, 950, 952, 953, 950, 950, 948, 948, 951, 949, 948, 946, 946, 946, 950, 950, 949, 945, 948, 949, 953, 952, 950, 948, 947, 948, 949, 948, 948, 945, 946, 947, 949, 948, 948, 947, 945, 946, 945, 950, 948, 949, 948, 950, 952, 949, 947, 947, 946, 946, 949, 949, 949, 947, 945, 944, 948, 949, 949, 946, 947, 951, 957, 957, 961, 959, 960, 963, 963, 965, 966, 966, 966, 967, 969, 967, 965, 961, 963, 964, 967, 967, 966, 963, 962, 963, 963, 968, 967, 966, 961, 957, 955, 955, 949, 949, 948, 947, 946, 947, 946, 946, 944, 940, 943, 943, 943, 941, 940, 940, 940, 944, 941, 940, 939, 941, 943, 943, 942, 939, 934, 928, 922, 919, 914, 902, 895, 898, 911, 927, 945, 962, 978, 1005, 1038, 1084, 1133, 1169, 1187, 1186, 1150, 1078, 996, 943, 921, 917, 927, 937, 938, 938, 937, 940, 939, 941, 940, 936, 935, 938, 937, 939, 938, 936, 935, 938, 938, 936, 936, 935, 933, 937, 937, 939, 939, 937, 934, 938, 940, 940, 939, 935, 936, 937, 939, 938, 937, 937, 938, 942, 940, 941, 940, 936, 938, 940, 940, 941, 938, 936, 937, 939, 939, 939, 942, 939, 938, 939, 943, 941, 941, 940, 938, 940, 940, 939, 938, 937, 935, 935, 936, 936, 934, 932, 931, 933, 934, 935, 931, 931, 930, 928, 932, 934, 932, 930, 929, 933, 936, 935, 937, 934, 935, 943, 945, 947, 948, 949, 949, 952, 955, 956, 959, 958, 958, 959, 962, 962, 963, 960, 960, 961, 964, 962, 960, 958, 958, 960, 960, 961, 960, 959, 958, 958, 959, 959, 958, 954, 956, 957, 957, 958, 958, 957, 955, 957, 960, 960, 957, 957, 953, 956, 957, 955, 954, 952, 952, 951, 953, 956, 953, 949, 951, 951, 953, 952, 954, 952, 949, 951, 952, 951, 952, 951, 953, 953, 955, 956, 954, 952, 951, 953, 955, 951, 952, 950, 951, 949, 952, 950, 951, 949, 948, 950, 951, 951, 952, 950, 950, 950, 950, 952, 952, 950, 951, 954, 955, 956, 957, 956, 961, 964, 967, 967, 966, 964, 964, 967, 969, 972, 972, 971, 970, 971, 973, 972, 971, 968, 965, 969, 968, 970, 966, 967, 969, 974, 979, 973, 967, 963, 960, 956, 956, 951, 949, 944, 944, 946, 946, 948, 947, 945, 944, 943, 945, 946, 947, 943, 942, 944, 944, 945, 945, 943, 944, 945, 946, 943, 940, 937, 933, 927, 924, 923, 920, 917, 913, 907, 908, 918, 941, 967, 1000, 1040, 1088, 1139, 1175, 1185, 1168, 1118, 1048, 982, 939, 927, 929, 937, 942, 943, 937, 939, 938, 940, 941, 939, 937, 935, 935, 935, 936, 939, 938, 936, 937, 937, 936, 936, 936, 934, 932, 936, 939, 939, 939, 938, 936, 937, 939, 940, 936, 937, 936, 935, 937, 937, 936, 934, 933, 936, 937, 938, 937, 937, 936, 936, 936, 935, 937, 937, 935, 936, 938, 939, 938, 936, 935, 937, 938, 940, 938, 937, 933, 936, 936, 936, 936, 935, 935, 937, 937, 939, 939, 936, 936, 934, 937, 936, 933, 933, 931, 934, 934, 935, 933, 933, 933, 933, 937, 937, 937, 938, 939, 942, 947, 949, 948, 948, 948, 953, 953, 953, 953, 951, 956, 958, 958, 957, 954, 955, 956, 956, 958, 958, 957, 955, 954, 955, 956, 956, 957, 953, 953, 955, 956, 954, 953, 953, 953, 952, 953, 952, 951, 950, 949, 951, 951, 951, 950, 947, 946, 946, 950, 950, 949, 947, 945, 945, 951, 950, 946, 946, 945, 947, 946, 946, 948, 946, 943, 946, 945, 944, 944, 941, 942, 943, 946, 947, 945, 942, 943, 948, 949, 947, 949, 948, 947, 950, 950, 950, 950, 948, 948, 947, 949, 948, 948, 947, 946, 951, 951, 953, 949, 952, 953, 957, 961, 963, 964, 962, 961, 966, 970, 970, 970, 966, 967, 969, 971, 970, 967, 964, 962, 965, 967, 967, 965, 962, 961, 967, 972, 971, 964, 955, 954, 954, 955, 950, 945, 946, 944, 946, 945, 944, 944, 941, 938, 939, 943, 940, 938, 939, 940, 942, 943, 944, 943, 939, 939, 941, 941, 940, 938, 929, 923, 917, 917, 907, 896, 894, 907, 928, 946, 956, 971, 989, 1016, 1054, 1099, 1136, 1165, 1178, 1169, 1122, 1052, 978, 928, 911, 916, 928, 934, 936, 934, 934, 934, 935, 938, 938, 934, 932, 931, 932, 933, 934, 934, 933, 932, 934, 935, 934, 933, 931, 930, 933, 935, 933, 933, 933, 933, 937, 937, 939, 935, 936, 934, 934, 933, 934, 933, 931, 932, 932, 935, 935, 932, 930, 931, 933, 937, 936, 934, 933, 931, 931, 931, 934, 935, 935, 935, 935, 938, 938, 937, 932, 934, 936, 939, 936, 933, 932, 929, 930, 933, 933, 930, 927, 927, 930, 930, 930, 928, 926, 926, 929, 932, 931, 929, 927, 927, 929, 928, 930, 929, 928, 928, 935, 936, 941, 941, 942, 942, 946, 948, 948, 947, 946, 948, 951, 952, 953, 951, 951, 951, 954, 954, 955, 953, 949, 947, 949, 953, 953, 954, 953, 950, 953, 953, 953, 949, 948, 948, 950, 952, 952, 950, 945, 945, 948, 951, 953, 949, 948, 949, 950, 950, 950, 945, 943, 943, 945, 944, 944, 942, 943, 942, 942, 944, 944, 942, 940, 941, 942, 945, 946, 945, 943, 943, 946, 946, 945, 943, 943, 941, 941, 940, 943, 943, 943, 938, 942, 942, 943, 942, 940, 940, 941, 944, 943, 943, 940, 943, 941, 944, 946, 945, 945, 945, 946, 948, 951, 955, 954, 955, 957, 956, 956, 955, 955, 957, 961, 966, 969, 969, 967, 964, 965, 964, 962, 963, 963, 962, 962, 960, 965, 965, 965, 962, 958, 957, 956, 951, 949, 944, 943, 944, 941, 941, 939, 939, 938, 943, 944, 944, 940, 939, 938, 941, 941, 938, 937, 938, 939, 940, 939, 939, 938, 939, 939, 939, 938, 935, 929, 919, 916, 917, 910, 903, 900, 913, 940, 967, 998, 1043, 1095, 1144, 1179, 1190, 1161, 1096, 1018, 955, 925, 917, 918, 926, 929, 928, 931, 930, 931, 933, 931, 928, 928, 934, 933, 932, 930, 929, 932, 934, 935, 931, 930, 931, 935, 935, 935, 934, 933, 931, 934, 934, 935, 933, 931, 931, 931, 935, 935, 934, 931, 930, 931, 933, 933, 932, 933, 932, 932, 935, 935, 935, 934, 932, 936, 937, 938, 936, 934, 934, 936, 937, 938, 936, 933, 932, 937, 936, 937, 936, 935, 933, 932, 936, 935, 933, 932, 932, 934, 933, 934, 932, 931, 929, 931, 930, 931, 929, 924, 921, 925, 926, 925, 923, 923, 922, 925, 926, 927, 927, 925, 926, 928, 932, 934, 934, 935, 937, 940, 941, 944, 944, 946, 948, 950, 952, 955, 954, 955, 955, 956, 959, 960, 957, 958, 958, 959, 962, 963, 962, 958, 960, 961, 963, 961, 962, 957, 957, 959, 959, 959, 957, 953, 955, 959, 959, 958, 958, 956, 954, 958, 959, 957, 957, 958, 955, 956, 958, 959, 956, 956, 955, 958, 960, 958, 960, 958, 957, 953, 957, 957, 956, 954, 953, 954, 955, 957, 954, 954, 953, 952, 954, 956, 953, 951, 950, 952, 956, 957, 955, 955, 953, 954, 957, 957, 958, 956, 956, 958, 960, 959, 957, 954, 955, 955, 956, 954, 957, 956, 953, 956, 958, 958, 955, 955, 955, 958, 963, 965, 967, 969, 970, 971, 975, 975, 974, 972, 972, 973, 977, 978, 977, 978, 978, 979, 981, 981, 977, 974, 973, 973, 977, 976, 976, 973, 971, 976, 983, 988, 982, 976, 971, 969, 967, 964, 959, 956, 956, 954, 956, 955, 955, 954, 954, 956, 958, 958, 958, 955, 954, 957, 957, 961, 957, 956, 955, 956, 958, 959, 956, 957, 955, 956, 958, 957, 953, 947, 939, 932, 931, 926, 919, 910, 910, 927, 948, 979, 1011, 1046, 1096, 1152, 1192, 1216, 1218, 1182, 1112, 1029, 967, 939, 932, 937, 945, 951, 953, 950, 950, 950, 949, 948, 949, 951, 949, 946, 947, 948, 948, 952, 950, 948, 946, 950, 952, 952, 949, 947, 946, 947, 949, 951, 948, 946, 948, 949, 951, 951, 949, 948, 947, 950, 951, 953, 952, 949, 946, 949, 952, 953, 949, 948, 950, 952, 952, 952, 951, 949, 950, 951, 952, 951, 951, 949, 950, 949, 951, 951, 951, 950, 946, 949, 951, 950, 950, 949, 950, 951, 951, 952, 952, 948, 949, 953, 954, 954, 951, 949, 949, 950, 951, 950, 947, 946, 944, 946, 948, 949, 948, 948, 946, 949, 952, 951, 950, 954, 953, 957, 960, 962, 961, 963, 964, 966, 967, 971, 971, 967, 970, 973, 976, 978, 975, 975, 973, 975, 978, 976, 975, 976, 972, 976, 976, 975, 974, 975, 973, 975, 975, 977, 974, 973, 971, 973, 975, 975, 974, 972, 972, 974, 974, 975, 970, 971, 969, 969, 971, 970, 968, 969, 968, 967, 971, 970, 969, 967, 967, 969, 969, 970, 969, 966, 965, 968, 970, 969, 967, 964, 963, 966, 966, 966, 965, 966, 963, 963, 966, 966, 964, 960, 963, 965, 968, 967, 964, 966, 966, 965, 968, 970, 969, 966, 964, 966, 968, 969, 967, 964, 964, 966, 967, 969, 967, 966, 965, 968, 968, 970, 970, 974, 975, 979, 981, 983, 983, 981, 982, 985, 988, 989, 988, 987, 986, 988, 991, 992, 988, 988, 984, 985, 987, 986, 986, 987, 984, 985, 985, 982, 984, 986, 988, 993, 988, 982, 977, 975, 973, 972, 970, 970, 966, 963, 962, 964, 969, 966, 966, 965, 964, 961, 963, 964, 962, 964, 962, 964, 963, 966, 964, 963, 961, 964, 963, 959, 952, 941, 934, 933, 926, 918, 923, 938, 963, 988, 1012, 1040, 1081, 1121, 1162, 1197, 1215, 1223, 1200, 1141, 1051, 982, 944, 939, 943, 952, 957, 957, 956, 957, 956, 954, 953, 954, 954, 954, 953, 950, 950, 953, 954, 953, 956, 954, 951, 953, 955, 955, 955, 954, 954, 956, 958, 959, 958, 955, 954, 957, 959, 958, 959, 956, 956, 957, 958, 958, 958, 955, 956, 957, 955, 957, 957, 954, 955, 957, 957, 957, 956, 955, 955, 955, 957, 956, 957, 953, 953, 955, 957, 957, 956, 954, 954, 955, 958, 957, 954, 954, 952, 954, 958, 956, 956, 955, 954, 957, 955, 957, 955, 953, 953, 957, 956, 956, 953, 952, 952, 954, 956, 958, 956, 956, 957, 963, 964, 965, 964, 966, 966, 970, 973, 971, 971, 972, 973, 975, 976, 976, 974, 974, 974, 977, 977, 978, 974, 974, 974, 975, 978, 977, 975, 973, 973, 974, 975, 975, 974, 973, 972, 972, 974, 974, 974, 971, 970, 969, 971, 972, 972, 970, 968, 970, 972, 973, 970, 970, 968, 970, 971, 970, 972, 969, 969, 971, 970, 970, 970, 969, 969, 970, 972, 970, 968, 967, 966, 966, 967, 970, 967, 963, 963, 966, 966, 968, 967, 967, 966, 965, 969, 969, 967, 966, 966, 968, 971, 972, 970, 970, 968, 970, 971, 971, 970, 967, 968, 969, 970, 969, 971, 969, 969, 970, 972, 971, 971, 972, 973, 975, 981, 984, 982, 980, 982, 985, 989, 989, 992, 989, 991, 992, 993, 993, 990, 987, 986, 989, 990, 990, 989, 985, 983, 987, 993, 997, 992, 985, 980, 981, 981, 975, 970, 966, 962, 965, 967, 967, 967, 965, 963, 965, 965, 965, 964, 963, 963, 965, 966, 965, 964, 961, 960, 962, 963, 964, 964, 963, 961, 957, 950, 943, 938, 933, 922, 917, 921, 936, 960, 983, 1014, 1065, 1122, 1167, 1190, 1187, 1148, 1078, 1004, 953, 933, 933, 944, 953, 954, 955, 953, 951, 950, 953, 956, 955, 954, 953, 951, 952, 951, 952, 951, 951, 950, 950, 953, 953, 953, 952, 951, 956, 956, 955, 954, 951, 951, 954, 956, 954, 954, 950, 952, 953, 954, 955, 953, 950, 950, 952, 953, 953, 955, 952, 952, 953, 955, 956, 956, 952, 953, 953, 954, 954, 954, 952, 954, 956, 957, 956, 953, 951, 952, 951, 953, 953, 954, 952, 949, 951, 953, 950, 949, 949, 948, 949, 948, 951, 950, 946, 943, 944, 945, 948, 946, 946, 944, 946, 948, 947, 943, 947, 947, 953, 955, 957, 958, 957, 960, 964, 967, 968, 967, 967, 965, 967, 970, 970, 970, 969, 967, 969, 971, 973, 973, 969, 968, 970, 971, 969, 968, 970, 970, 973, 974, 975, 971, 969, 966, 967, 970, 971, 974, 970, 968, 968, 968, 968, 967, 963, 965, 966, 965, 968, 966, 965, 963, 965, 966, 967, 969, 966, 963, 964, 965, 966, 965, 964, 962, 965, 964, 967, 965, 962, 961, 962, 962, 962, 960, 963, 965, 968, 968, 968, 965, 963, 963, 964, 965, 966, 964, 967, 965, 965, 965, 965, 965, 963, 962, 964, 966, 966, 966, 964, 964, 970, 975, 976, 974, 974, 974, 979, 982, 985, 986, 986, 986, 986, 985, 987, 987, 982, 984, 984, 987, 984, 981, 978, 976, 982, 989, 989, 981, 975, 971, 971, 970, 966, 964, 964, 959, 961, 963, 966, 967, 967, 967, 969, 970, 968, 965, 962, 958, 960, 963, 964, 961, 961, 959, 961, 960, 958, 958, 959, 959, 960, 957, 951, 944, 938, 929, 923, 921, 934, 954, 982, 1012, 1058, 1113, 1167, 1201, 1209, 1176, 1107, 1031, 974, 942, 932, 936, 947, 954, 954, 956, 953, 952, 954, 955, 954, 954, 950, 951, 954, 956, 956, 955, 953, 950, 953, 955, 956, 955, 953, 952, 955, 954, 955, 956, 952, 951, 953, 953, 954, 955, 952, 951, 953, 954, 955, 954, 953, 954, 952, 955, 955, 955, 953, 951, 955, 956, 954, 958, 952, 952, 954, 956, 957, 956, 954, 955, 956, 956, 956, 955, 955, 950, 953, 955, 955, 951, 948, 948, 948, 947, 949, 946, 946, 944, 944, 945, 945, 942, 943, 941, 943, 947, 948, 948, 947, 948, 953, 956, 959, 958, 959, 963, 965, 968, 967, 968, 970, 970, 972, 974, 975, 974, 972, 973, 974, 975, 977, 978, 976, 974, 976, 978, 978, 977, 977, 976, 976, 977, 978, 977, 972, 974, 975, 977, 977, 977, 974, 972, 973, 976, 976, 976, 973, 974, 975, 975, 977, 975, 972, 972, 974, 974, 975, 975, 973, 973, 972, 973, 973, 972, 972, 972, 972, 975, 976, 973, 972, 969, 973, 973, 973, 974, 970, 971, 972, 973, 974, 973, 973, 968, 970, 970, 973, 973, 971, 970, 972, 973, 975, 975, 974, 971, 969, 977, 975, 972, 972, 973, 974, 976, 978, 975, 975, 974, 981, 986, 988, 986, 986, 987, 990, 989, 992, 993, 994, 993, 998, 997, 996, 994, 994, 991, 992, 992, 994, 992, 989, 987, 992, 996, 1001, 996, 988, 984, 983, 984, 977, 974, 974, 971, 971, 971, 974, 973, 972, 972, 973, 974, 974, 973, 972, 971, 972, 972, 972, 972, 969, 967, 970, 971, 971, 969, 969, 968, 968, 971, 964, 956, 947, 941, 938, 930, 934, 948, 977, 1008, 1048, 1100, 1158, 1204, 1230, 1220, 1175, 1098, 1015, 958, 942, 948, 960, 967, 966, 965, 962, 962, 962, 964, 964, 964, 962, 960, 962, 962, 964, 962, 961, 961, 961, 962, 963, 961, 962, 961, 960, 963, 963, 964, 963, 959, 962, 966, 964, 963, 962, 960, 961, 964, 965, 966, 963, 961, 962, 962, 965, 963, 962, 960, 963, 963, 963, 963, 963, 961, 963, 962, 964, 963, 963, 963, 963, 963, 963, 961, 960, 960, 963, 965, 964, 963, 961, 960, 962, 962, 964, 962, 960, 962, 961, 963, 964, 962, 960, 960, 960, 961, 963, 962, 960, 961, 962, 965, 967, 969, 968, 970, 974, 977, 979, 980, 978, 979, 980, 982, 986, 985, 984, 982, 984, 985, 987, 986, 986, 986, 988, 989, 988, 987, 984, 985, 986, 985, 988, 986, 984, 982, 984, 984, 983, 982, 980, 982, 982, 983, 985, 983, 981, 981, 981, 982, 983, 981, 981, 980, 980, 982, 982, 979, 978, 978, 978, 978, 981, 977, 975, 975, 975, 978, 979, 977, 978, 975, 977, 979, 979, 979, 977, 974, 979, 979, 979, 978, 978, 975, 976, 978, 981, 979, 977, 978, 977, 980, 982, 981, 980, 978, 981, 982, 983, 981, 982, 980, 977, 983, 981, 983, 983, 982, 985, 990, 993, 991, 991, 990, 993, 999, 998, 998, 1000, 998, 1000, 1004, 1004, 1002, 1000, 996, 997, 998, 1001, 1000, 995, 995, 996, 1005, 1008, 1004, 995, 990, 989, 988, 983, 981, 980, 977, 977, 978, 979, 978, 975, 972, 976, 976, 977, 975, 977, 972, 975, 974, 974, 977, 975, 974, 975, 976, 980, 978, 978, 977, 974, 973, 969, 959, 954, 947, 948, 942, 935, 933, 942, 965, 998, 1031, 1075, 1130, 1176, 1206, 1218, 1195, 1136, 1057, 992, 955, 949, 958, 968, 970, 969, 967, 969, 970, 972, 970, 968, 965, 968, 968, 969, 966, 965, 965, 966, 968, 969, 967, 967, 966, 968, 968, 970, 968, 965, 964, 966, 970, 969, 970, 967, 965, 969, 970, 972, 971, 969, 968, 968, 969, 973, 970, 970, 968, 968, 970, 970, 970, 967, 967, 967, 971, 969, 968, 966, 965, 968, 967, 969, 970, 970, 968, 969, 969, 971, 970, 968, 965, 967, 969, 970, 967, 967, 965, 966, 967, 968, 967, 966, 962, 963, 964, 965, 963, 962, 961, 962, 963, 967, 966, 965, 965, 966, 969, 972, 973, 975, 972, 975, 981, 980, 981, 980, 981, 983, 988, 984, 986, 984, 985, 987, 989, 988, 986, 989, 985, 986, 986, 987, 987, 985, 985, 986, 987, 990, 989, 985, 982, 984, 986, 985, 985, 984, 982, 984, 984, 984, 983, 981, 980, 983, 985, 986, 982, 978, 979, 978, 981, 980, 980, 981, 979, 983, 982, 983, 982, 981, 979, 981, 980, 981, 980, 978, 977, 978, 980, 981, 979, 977, 976, 980, 978, 978, 980, 976, 974, 976, 978, 978, 976, 978, 977, 976, 980, 982, 982, 979, 979, 977, 978, 977, 976, 975, 974, 976, 980, 981, 980, 980, 978, 981, 984, 985, 987, 988, 987, 987, 992, 993, 993, 995, 993, 997, 999, 1000, 999, 995, 995, 995, 997, 997, 994, 993, 994, 995, 993, 990, 989, 991, 992, 996, 1000, 1003, 1002, 996, 989, 988, 988, 988, 984, 979, 975, 973, 975, 974, 971, 968, 969, 972, 975, 975, 973, 969, 967, 971, 971, 973, 973, 969, 967, 967, 968, 971, 966, 965, 964, 967, 966, 963, 956, 950, 946, 943, 931, 929, 932, 949, 970, 997, 1036, 1084, 1137, 1176, 1202, 1201, 1174, 1112, 1042, 983, 952, 940, 943, 952, 958, 958, 956, 958, 961, 966, 963, 963, 960, 964, 966, 963, 962, 963, 961, 959, 961, 962, 962, 961, 961, 961, 961, 963, 961, 961, 960, 961, 961, 960, 959, 958, 957, 958, 959, 962, 962, 962, 960, 963, 962, 961, 960, 959, 956, 958, 960, 960, 961, 961, 960, 963, 960, 960, 958, 958, 957, 960, 964, 964, 961, 961, 962, 963, 965, 964, 964, 962, 960, 961, 960, 959, 960, 958, 957, 960, 961, 961, 958, 957, 954, 955, 956, 956, 956, 956, 952, 951, 954, 954, 952, 949, 951, 950, 951, 954, 954, 956, 956, 957, 958, 963, 964, 966, 969, 969, 972, 971, 973, 973, 975, 979, 982, 982, 980, 979, 978, 981, 981, 983, 980, 982, 979, 980, 982, 982, 981, 980, 977, 980, 983, 983, 981, 979, 978, 979, 981, 980, 980, 981, 978, 976, 979, 979, 978, 979, 976, 978, 977, 975, 973, 973, 972, 972, 974, 976, 975, 974, 973, 975, 979, 975, 971, 970, 967, 969, 972, 973, 972, 974, 971, 971, 972, 975, 974, 973, 968, 971, 973, 974, 972, 971, 971, 973, 974, 973, 971, 969, 968, 973, 974, 975, 974, 973, 969, 972, 975, 977, 974, 971, 971, 973, 972, 973, 973, 976, 975, 978, 980, 984, 983, 981, 984, 984, 989, 992, 992, 991, 990, 992, 996, 995, 994, 991, 990, 989, 991, 990, 989, 988, 983, 986, 990, 992, 995, 995, 987, 983, 982, 980, 976, 971, 968, 969, 971, 968, 968, 968, 968, 969, 970, 969, 968, 965, 966, 967, 969, 969, 968, 969, 965, 967, 968, 967, 969, 964, 963, 959, 953, 950, 944, 936, 926, 924, 935, 956, 982, 1006, 1043, 1094, 1148, 1192, 1221, 1224, 1196, 1134, 1063, 1005, 966, 947, 938, 935, 938, 941, 945, 954, 956, 957, 959, 960, 961, 959, 959, 960, 961, 962, 961, 959, 957, 961, 963, 963, 961, 960, 960, 960, 962, 960, 964, 962, 960, 960, 963, 963, 961, 962, 961, 962, 965, 964, 965, 963, 960, 963, 964, 964, 964, 962, 960, 964, 963, 966, 965, 963, 958, 961, 962, 965, 962, 961, 960, 964, 962, 964, 965, 961, 960, 962, 963, 963, 964, 964, 963, 964, 963, 964, 964, 964, 960, 959, 961, 963, 962, 957, 954, 955, 961, 957, 958, 955, 953, 955, 955, 954, 956, 953, 951, 954, 954, 956, 955, 956, 954, 957, 961, 962, 966, 965, 966, 968, 973, 976, 977, 975, 976, 979, 980, 982, 982, 983, 982, 982, 985, 987, 986, 985, 980, 984, 984, 987, 986, 983, 983, 983, 983, 985, 985, 984, 983, 984, 984, 986, 983, 983, 982, 984, 984, 985, 983, 980, 980, 980, 982, 982, 982, 981, 978, 980, 981, 979, 980, 979, 977, 980, 980, 982, 978, 975};
void main(void) {
    printk("WELCOME TO PAN TOMPKINS MASTER CODE"); // Print the initialized value
}

FILE *fin, *fout;       // Remove them if not using files and <stdio.h>.

/*
    Use this function for any kind of setup you need before getting samples.
    This is a good place to open a file, initialize your hardware and/or open
    a serial connection.
    Remember to update its parameters on the panTompkins.h file as well.
*/
void init( char file_in[], char file_out[])
{
	fin = fopen("examples\test_input.txt", "r");
	fout = fopen("examples\test_output.txt", "w+");
}
/*
int main() {
    // Open the input and output files
    fin = fopen("examples\test_input.txt", "r");
    fout = fopen("examples\test_output.txt", "w");
}
*/
/*
    Use this function to read and return the next sample and put it in a suitable, numeric format. Return the
    sample, or NOSAMPLE if there are no more samples.
*/
dataType input()
{
	int num = NOSAMPLE;
	if (!feof(fin))
		fscanf(fin, "%d", &num);

	return num;
}

/*
    Use this function to output the information you see fit (last RR-interval,
    sample index which triggered a peak detection, whether each sample was a R
    peak (1) or not (0) etc)
*/
void output(int out)
{
	fprintf(fout, "%d\n", out);
}

/*
    This is the actual QRS-detecting function. It's a loop that constantly calls the input and output functions
    and updates the thresholds and averages until there are no more samples. More details both above and in
    shorter comments below.
*/
void panTompkins()
{
    // The signal array is where the most recent samples are kept. The other arrays are the outputs of each
    // filtering module: DC Block, low pass, high pass, integral etc.
	// The output is a buffer where we can change a previous result (using a back search) before outputting.
	dataType signal[BUFFSIZE], dcblock[BUFFSIZE], lowpass[BUFFSIZE], highpass[BUFFSIZE], derivative[BUFFSIZE], squared[BUFFSIZE], integral[BUFFSIZE], outputSignal[BUFFSIZE];

	// rr1 holds the last 8 RR intervals. rr2 holds the last 8 RR intervals between rrlow and rrhigh.
	// rravg1 is the rr1 average, rr2 is the rravg2. rrlow = 0.92*rravg2, rrhigh = 1.08*rravg2 and rrmiss = 1.16*rravg2.
	// rrlow is the lowest RR-interval considered normal for the current heart beat, while rrhigh is the highest.
	// rrmiss is the longest that it would be expected until a new QRS is detected. If none is detected for such
	// a long interval, the thresholds must be adjusted.
	int rr1[8], rr2[8], rravg1, rravg2, rrlow = 0, rrhigh = 0, rrmiss = 0;

	// i and j are iterators for loops.
	// sample counts how many samples have been read so far.
	// lastQRS stores which was the last sample read when the last R sample was triggered.
	// lastSlope stores the value of the squared slope when the last R sample was triggered.
	// currentSlope helps calculate the max. square slope for the present sample.
	// These are all long unsigned int so that very long signals can be read without messing the count.
	long unsigned int i, j, sample = 0, lastQRS = 0, lastSlope = 0, currentSlope = 0;

	// This variable is used as an index to work with the signal buffers. If the buffers still aren't
	// completely filled, it shows the last filled position. Once the buffers are full, it'll always
	// show the last position, and new samples will make the buffers shift, discarding the oldest
	// sample and storing the newest one on the last position.
	int current;

	// There are the variables from the original Pan-Tompkins algorithm.
	// The ones ending in _i correspond to values from the integrator.
	// The ones ending in _f correspond to values from the DC-block/low-pass/high-pass filtered signal.
	// The peak variables are peak candidates: signal values above the thresholds.
	// The threshold 1 variables are the threshold variables. If a signal sample is higher than this threshold, it's a peak.
	// The threshold 2 variables are half the threshold 1 ones. They're used for a back search when no peak is detected for too long.
	// The spk and npk variables are, respectively, running estimates of signal and noise peaks.
	dataType peak_i = 0, peak_f = 0, threshold_i1 = 0, threshold_i2 = 0, threshold_f1 = 0, threshold_f2 = 0, spk_i = 0, spk_f = 0, npk_i = 0, npk_f = 0;

	// qrs tells whether there was a detection or not.
	// regular tells whether the heart pace is regular or not.
	// prevRegular tells whether the heart beat was regular before the newest RR-interval was calculated.
	bool qrs, regular = true, prevRegular;

	// Initializing the RR averages
	for (i = 0; i < 8; i++)
    {
        rr1[i] = 0;
        rr2[i] = 0;
    }

    // The main loop where everything proposed in the paper happens. Ends when there are no more signal samples.
    do{
        // Test if the buffers are full.
        // If they are, shift them, discarding the oldest sample and adding the new one at the end.
        // Else, just put the newest sample in the next free position.
        // Update 'current' so that the program knows where's the newest sample.
		if (sample >= BUFFSIZE)
		{
			for (i = 0; i < BUFFSIZE - 1; i++)
			{
				signal[i] = signal[i+1];
				dcblock[i] = dcblock[i+1];
				lowpass[i] = lowpass[i+1];
				highpass[i] = highpass[i+1];
				derivative[i] = derivative[i+1];
				squared[i] = squared[i+1];
				integral[i] = integral[i+1];
				outputSignal[i] = outputSignal[i+1];
			}
			current = BUFFSIZE - 1;
		}
		else
		{
			current = sample;
		}
		signal[current] = input();

		// If no sample was read, stop processing!
		if (signal[current] == NOSAMPLE)
			break;
		sample++; // Update sample counter

		// DC Block filter
		// This was not proposed on the original paper.
		// It is not necessary and can be removed if your sensor or database has no DC noise.
		if (current >= 1)
			dcblock[current] = signal[current] - signal[current-1] + 0.995*dcblock[current-1];
		else
			dcblock[current] = 0;

		// Low Pass filter
		// Implemented as proposed by the original paper.
		// y(nT) = 2y(nT - T) - y(nT - 2T) + x(nT) - 2x(nT - 6T) + x(nT - 12T)
		// Can be removed if your signal was previously filtered, or replaced by a different filter.
		lowpass[current] = dcblock[current];
		if (current >= 1)
			lowpass[current] += 2*lowpass[current-1];
		if (current >= 2)
			lowpass[current] -= lowpass[current-2];
		if (current >= 6)
			lowpass[current] -= 2*dcblock[current-6];
		if (current >= 12)
			lowpass[current] += dcblock[current-12];

		// High Pass filter
		// Implemented as proposed by the original paper.
		// y(nT) = 32x(nT - 16T) - [y(nT - T) + x(nT) - x(nT - 32T)]
		// Can be removed if your signal was previously filtered, or replaced by a different filter.
		highpass[current] = -lowpass[current];
		if (current >= 1)
			highpass[current] -= highpass[current-1];
		if (current >= 16)
			highpass[current] += 32*lowpass[current-16];
		if (current >= 32)
			highpass[current] += lowpass[current-32];

		// Derivative filter
		// This is an alternative implementation, the central difference method.
		// f'(a) = [f(a+h) - f(a-h)]/2h
		// The original formula used by Pan-Tompkins was:
		// y(nT) = (1/8T)[-x(nT - 2T) - 2x(nT - T) + 2x(nT + T) + x(nT + 2T)]
        derivative[current] = highpass[current];
		if (current > 0)
			derivative[current] -= highpass[current-1];

		// This just squares the derivative, to get rid of negative values and emphasize high frequencies.
		// y(nT) = [x(nT)]^2.
		squared[current] = derivative[current]*derivative[current];

		// Moving-Window Integration
		// Implemented as proposed by the original paper.
		// y(nT) = (1/N)[x(nT - (N - 1)T) + x(nT - (N - 2)T) + ... x(nT)]
		// WINDOWSIZE, in samples, must be defined so that the window is ~150ms.

		integral[current] = 0;
		for (i = 0; i < WINDOWSIZE; i++)
		{
			if (current >= (dataType)i)
				integral[current] += squared[current - i];
			else
				break;
		}
		integral[current] /= (dataType)i;

		qrs = false;

		// If the current signal is above one of the thresholds (integral or filtered signal), it's a peak candidate.
        if (integral[current] >= threshold_i1 || highpass[current] >= threshold_f1)
        {
            peak_i = integral[current];
            peak_f = highpass[current];
        }

		// If both the integral and the signal are above their thresholds, they're probably signal peaks.
		if ((integral[current] >= threshold_i1) && (highpass[current] >= threshold_f1))
		{
			// There's a 200ms latency. If the new peak respects this condition, we can keep testing.
			if (sample > lastQRS + FS/5)
			{
			    // If it respects the 200ms latency, but it doesn't respect the 360ms latency, we check the slope.
				if (sample <= lastQRS + (long unsigned int)(0.36*FS))
				{
				    // The squared slope is "M" shaped. So we have to check nearby samples to make sure we're really looking
				    // at its peak value, rather than a low one.
				    currentSlope = 0;
				    for (j = current - 10; j <= current; j++)
                        if (squared[j] > currentSlope)
                            currentSlope = squared[j];

				    if (currentSlope <= (dataType)(lastSlope/2))
                    {
                        qrs = false;
                    }

                    else
                    {
                        spk_i = 0.125*peak_i + 0.875*spk_i;
                        threshold_i1 = npk_i + 0.25*(spk_i - npk_i);
                        threshold_i2 = 0.5*threshold_i1;

                        spk_f = 0.125*peak_f + 0.875*spk_f;
                        threshold_f1 = npk_f + 0.25*(spk_f - npk_f);
                        threshold_f2 = 0.5*threshold_f1;

                        lastSlope = currentSlope;
                        qrs = true;
                    }
				}
				// If it was above both thresholds and respects both latency periods, it certainly is a R peak.
				else
				{
				    currentSlope = 0;
                    for (j = current - 10; j <= current; j++)
                        if (squared[j] > currentSlope)
                            currentSlope = squared[j];

                    spk_i = 0.125*peak_i + 0.875*spk_i;
                    threshold_i1 = npk_i + 0.25*(spk_i - npk_i);
                    threshold_i2 = 0.5*threshold_i1;

                    spk_f = 0.125*peak_f + 0.875*spk_f;
                    threshold_f1 = npk_f + 0.25*(spk_f - npk_f);
                    threshold_f2 = 0.5*threshold_f1;

                    lastSlope = currentSlope;
                    qrs = true;
				}
			}
			// If the new peak doesn't respect the 200ms latency, it's noise. Update thresholds and move on to the next sample.
			else
            {
                peak_i = integral[current];
				npk_i = 0.125*peak_i + 0.875*npk_i;
				threshold_i1 = npk_i + 0.25*(spk_i - npk_i);
				threshold_i2 = 0.5*threshold_i1;
				peak_f = highpass[current];
				npk_f = 0.125*peak_f + 0.875*npk_f;
				threshold_f1 = npk_f + 0.25*(spk_f - npk_f);
                threshold_f2 = 0.5*threshold_f1;
                qrs = false;
				outputSignal[current] = qrs;
				if (sample > DELAY + BUFFSIZE)
                	output(outputSignal[0]);
                continue;
            }

		}

		// If a R-peak was detected, the RR-averages must be updated.
		if (qrs)
		{
			// Add the newest RR-interval to the buffer and get the new average.
			rravg1 = 0;
			for (i = 0; i < 7; i++)
			{
				rr1[i] = rr1[i+1];
				rravg1 += rr1[i];
			}
			rr1[7] = sample - lastQRS;
			lastQRS = sample;
			rravg1 += rr1[7];
			rravg1 *= 0.125;

			// If the newly-discovered RR-average is normal, add it to the "normal" buffer and get the new "normal" average.
			// Update the "normal" beat parameters.
			if ( (rr1[7] >= rrlow) && (rr1[7] <= rrhigh) )
			{
				rravg2 = 0;
				for (i = 0; i < 7; i++)
				{
					rr2[i] = rr2[i+1];
					rravg2 += rr2[i];
				}
				rr2[7] = rr1[7];
				rravg2 += rr2[7];
				rravg2 *= 0.125;
				rrlow = 0.92*rravg2;
				rrhigh = 1.16*rravg2;
				rrmiss = 1.66*rravg2;
			}

			prevRegular = regular;
			if (rravg1 == rravg2)
			{
				regular = true;
			}
			// If the beat had been normal but turned odd, change the thresholds.
			else
			{
				regular = false;
				if (prevRegular)
				{
					threshold_i1 /= 2;
					threshold_f1 /= 2;
				}
			}
		}
		// If no R-peak was detected, it's important to check how long it's been since the last detection.
		else
		{
		    // If no R-peak was detected for too long, use the lighter thresholds and do a back search.
			// However, the back search must respect the 200ms limit and the 360ms one (check the slope).
			if ((sample - lastQRS > (long unsigned int)rrmiss) && (sample > lastQRS + FS/5))
			{
				for (i = current - (sample - lastQRS) + FS/5; i < (long unsigned int)current; i++)
				{
					if ( (integral[i] > threshold_i2) && (highpass[i] > threshold_f2))
					{
					    currentSlope = 0;
                        for (j = i - 10; j <= i; j++)
                            if (squared[j] > currentSlope)
                                currentSlope = squared[j];

                        if ((currentSlope < (dataType)(lastSlope/2)) && (i + sample) < lastQRS + 0.36*lastQRS)
                        {
                            qrs = false;
                        }
                        else
                        {
                            peak_i = integral[i];
                            peak_f = highpass[i];
                            spk_i = 0.25*peak_i+ 0.75*spk_i;
                            spk_f = 0.25*peak_f + 0.75*spk_f;
                            threshold_i1 = npk_i + 0.25*(spk_i - npk_i);
                            threshold_i2 = 0.5*threshold_i1;
                            lastSlope = currentSlope;
                            threshold_f1 = npk_f + 0.25*(spk_f - npk_f);
                            threshold_f2 = 0.5*threshold_f1;
                            // If a signal peak was detected on the back search, the RR attributes must be updated.
                            // This is the same thing done when a peak is detected on the first try.
                            //RR Average 1
                            rravg1 = 0;
                            for (j = 0; j < 7; j++)
                            {
                                rr1[j] = rr1[j+1];
                                rravg1 += rr1[j];
                            }
                            rr1[7] = sample - (current - i) - lastQRS;
                            qrs = true;
                            lastQRS = sample - (current - i);
                            rravg1 += rr1[7];
                            rravg1 *= 0.125;

                            //RR Average 2
                            if ( (rr1[7] >= rrlow) && (rr1[7] <= rrhigh) )
                            {
                                rravg2 = 0;
                                for (i = 0; i < 7; i++)
                                {
                                    rr2[i] = rr2[i+1];
                                    rravg2 += rr2[i];
                                }
                                rr2[7] = rr1[7];
                                rravg2 += rr2[7];
                                rravg2 *= 0.125;
                                rrlow = 0.92*rravg2;
                                rrhigh = 1.16*rravg2;
                                rrmiss = 1.66*rravg2;
                            }

                            prevRegular = regular;
                            if (rravg1 == rravg2)
                            {
                                regular = true;
                            }
                            else
                            {
                                regular = false;
                                if (prevRegular)
                                {
                                    threshold_i1 /= 2;
                                    threshold_f1 /= 2;
                                }
                            }

                            break;
                        }
                    }
				}

				if (qrs)
                {
                    outputSignal[current] = false;
                    outputSignal[i] = true;
                    if (sample > DELAY + BUFFSIZE)
                        output(outputSignal[0]);
                    continue;
                }
			}

			// Definitely no signal peak was detected.
			if (!qrs)
			{
				// If some kind of peak had been detected, then it's certainly a noise peak. Thresholds must be updated accordinly.
				if ((integral[current] >= threshold_i1) || (highpass[current] >= threshold_f1))
				{
					peak_i = integral[current];
					npk_i = 0.125*peak_i + 0.875*npk_i;
					threshold_i1 = npk_i + 0.25*(spk_i - npk_i);
					threshold_i2 = 0.5*threshold_i1;
					peak_f = highpass[current];
					npk_f = 0.125*peak_f + 0.875*npk_f;
					threshold_f1 = npk_f + 0.25*(spk_f - npk_f);
					threshold_f2 = 0.5*threshold_f1;
				}
			}
		}
		// The current implementation outputs '0' for every sample where no peak was detected,
		// and '1' for every sample where a peak was detected. It should be changed to fit
		// the desired application.
		// The 'if' accounts for the delay introduced by the filters: we only start outputting after the delay.
		// However, it updates a few samples back from the buffer. The reason is that if we update the detection
		// for the current sample, we might miss a peak that could've been found later by backsearching using
		// lighter thresholds. The final waveform output does match the original signal, though.
		outputSignal[current] = qrs;
		if (sample > DELAY + BUFFSIZE)
			output(outputSignal[0]);
	} while (signal[current] != NOSAMPLE);

	// Output the last remaining samples on the buffer
	for (i = 1; i < BUFFSIZE; i++)
		output(outputSignal[i]);

	// These last two lines must be deleted if you are not working with files.
	fclose(fin);
	fclose(fout);
}
